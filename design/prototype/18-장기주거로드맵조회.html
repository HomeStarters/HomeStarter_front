<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ê¸°ì£¼ê±° ë¡œë“œë§µ</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Timeline Section */
        .timeline-section {
            padding: var(--spacing-md);
            background: var(--background);
            overflow-x: auto;
            overflow-y: hidden;
        }

        .timeline-wrapper {
            min-width: max-content;
            padding: var(--spacing-xl) 0;
        }

        .timeline-track {
            position: relative;
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
        }

        /* Current Marker */
        .current-marker {
            position: relative;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: var(--spacing-lg);
        }

        .current-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
            margin-bottom: var(--spacing-xs);
        }

        .current-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
        }

        .current-line {
            width: 2px;
            height: 160px;
            background: var(--primary);
        }

        /* Stage Cards */
        .stage-card {
            min-width: 240px;
            height: 180px;
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }

        .stage-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stage-card.active {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .stage-icon {
            font-size: 32px;
            margin-bottom: var(--spacing-sm);
        }

        .stage-name {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-2xs);
        }

        .stage-date {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .stage-price {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
            margin-top: auto;
        }

        .stage-type {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        /* Lifecycle Events */
        .events-track {
            position: absolute;
            top: -40px;
            left: 0;
            right: 0;
            display: flex;
            gap: var(--spacing-md);
            padding-left: 100px;
        }

        .event-marker {
            min-width: 240px;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .event-icon {
            font-size: 16px;
        }

        /* Guide Section */
        .guide-section {
            padding: var(--spacing-lg) var(--spacing-md);
        }

        .guide-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border);
            margin-bottom: var(--spacing-md);
        }

        .guide-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
        }

        .guide-item {
            margin-bottom: var(--spacing-md);
        }

        .guide-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .guide-value {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }

        .progress-label {
            font-size: var(--font-size-sm);
            color: var(--success);
            margin-top: var(--spacing-2xs);
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            box-shadow: var(--shadow-xl);
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
        }

        .bottom-sheet.active {
            transform: translateY(0);
        }

        .bottom-sheet-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .bottom-sheet-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }

        .bottom-sheet-body {
            padding: var(--spacing-md);
            overflow-y: auto;
            flex: 1;
        }

        .detail-section {
            margin-bottom: var(--spacing-lg);
        }

        .detail-section-title {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-xs);
            border-bottom: 1px solid var(--border);
        }

        .detail-grid {
            display: grid;
            gap: var(--spacing-sm);
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .detail-value {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .detail-text {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .backdrop.active {
            display: block;
        }

        /* Action Buttons */
        .action-buttons {
            padding: var(--spacing-md);
            background: white;
            border-top: 1px solid var(--border);
            display: flex;
            gap: var(--spacing-sm);
        }

        .action-buttons .btn {
            flex: 1;
        }

        @media (min-width: 768px) {
            .stage-card {
                min-width: 280px;
                height: 200px;
            }

            .event-marker {
                min-width: 280px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <button class="btn-back" onclick="history.back()" aria-label="ë’¤ë¡œ ê°€ê¸°">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <h1 class="header-title">ì¥ê¸°ì£¼ê±° ë¡œë“œë§µ</h1>
        <div class="header-actions"></div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Timeline Section -->
            <div class="timeline-section">
                <div class="timeline-wrapper">
                    <div class="timeline-track">
                        <!-- Lifecycle Events Track -->
                        <div class="events-track" id="eventsTrack"></div>

                        <!-- Current Marker -->
                        <div class="current-marker">
                            <div class="current-label">í˜„ì¬</div>
                            <div class="current-icon">ğŸ“</div>
                            <div class="current-line"></div>
                        </div>

                        <!-- Stage Cards -->
                        <div id="stageCards"></div>
                    </div>
                </div>
            </div>

            <!-- Guide Section -->
            <div class="guide-section">
                <div class="guide-card">
                    <h2 class="guide-title">í˜„ì¬ ì‹¤í–‰ê°€ì´ë“œ</h2>

                    <div class="guide-item">
                        <div class="guide-label">ì›”ë³„ ì €ì¶• í”Œëœ</div>
                        <div class="guide-value" id="monthlySavings">0ì›</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="savingsProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label" id="savingsLabel">ëª©í‘œ ëŒ€ë¹„ 0% ë‹¬ì„±</div>
                    </div>

                    <div class="guide-item">
                        <div class="guide-label">ë‹¤ìŒ ë‹¨ê³„ê¹Œì§€</div>
                        <div class="guide-value" id="timeRemaining">-</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="timeProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" id="editRoadmapBtn">
                    ë¡œë“œë§µ ìˆ˜ì •
                </button>
                <button type="button" class="btn btn-secondary" id="downloadBtn">
                    PDF ë‹¤ìš´ë¡œë“œ
                </button>
                <button type="button" class="btn btn-primary" id="shareBtn">
                    ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <!-- Backdrop -->
    <div class="backdrop" id="backdrop"></div>

    <!-- Bottom Sheet -->
    <div class="bottom-sheet" id="detailSheet">
        <div class="bottom-sheet-header">
            <h2 class="bottom-sheet-title" id="sheetTitle">ë‹¨ê³„ ìƒì„¸</h2>
            <button class="modal-close" id="closeSheet" aria-label="ë‹«ê¸°" style="width: 32px; height: 32px; border: none; background: none; cursor: pointer; color: var(--text-secondary); font-size: 24px;">&times;</button>
        </div>
        <div class="bottom-sheet-body" id="sheetBody">
            <!-- Content will be rendered here -->
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // Sample roadmap data
        const sampleRoadmap = {
            stages: [
                {
                    id: 1,
                    name: '1ë‹¨ê³„ - ì‹ í˜¼ì§‘',
                    icon: 'ğŸ ',
                    date: '2026-03',
                    price: 300000000,
                    type: 'ì „ì„¸ 60ã¡',
                    location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
                    houseType: 'ì•„íŒŒíŠ¸ 60ã¡',
                    considerations: 'ì‹ í˜¼ì§‘, ì¶œí‡´ê·¼ í¸ë¦¬, ì†Œí˜•',
                    financialGoal: {
                        needed: 300000000,
                        savings: 100000000,
                        loan: 200000000
                    },
                    strategy: {
                        monthlySavings: 2500000,
                        investment: 'ì•ˆì •ì ì¸ ì˜ˆì ê¸ˆ ìœ„ì£¼ë¡œ ìì‚° ê´€ë¦¬',
                        caution: 'ëŒ€ì¶œ í•œë„ì™€ ê¸ˆë¦¬ ë³€ë™ì„± ì£¼ì˜'
                    }
                },
                {
                    id: 2,
                    name: '2ë‹¨ê³„ - ìë…€ ì–‘ìœ¡ì§‘',
                    icon: 'ğŸ‘¶',
                    date: '2030-06',
                    price: 500000000,
                    type: 'ë§¤ë§¤ 84ã¡',
                    location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
                    houseType: 'ì•„íŒŒíŠ¸ 84ã¡',
                    considerations: 'í•™êµ° ì¢‹ì€ ì§€ì—­, ì¤‘ëŒ€í˜•',
                    financialGoal: {
                        needed: 500000000,
                        savings: 250000000,
                        loan: 250000000
                    },
                    strategy: {
                        monthlySavings: 3000000,
                        investment: 'ì£¼íƒì²­ì•½ ë° ì ë¦½ì‹ í€ë“œ ë³‘í–‰',
                        caution: 'í•™êµ° ì§€ì—­ ì‹œì„¸ ìƒìŠ¹ë¥  ëª¨ë‹ˆí„°ë§ í•„ìš”'
                    }
                },
                {
                    id: 3,
                    name: '3ë‹¨ê³„ - ìµœì¢…ëª©í‘œ',
                    icon: 'ğŸ¡',
                    date: '2035-12',
                    price: 800000000,
                    type: 'ë§¤ë§¤ 120ã¡',
                    location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
                    houseType: 'ì•„íŒŒíŠ¸ 120ã¡',
                    considerations: 'ëª…ë¬¸í•™êµ°, ëŒ€í˜•, ì¾Œì í•œ í™˜ê²½',
                    financialGoal: {
                        needed: 800000000,
                        savings: 500000000,
                        loan: 300000000
                    },
                    strategy: {
                        monthlySavings: 4000000,
                        investment: 'ê¸°ì¡´ ì£¼íƒ ë§¤ê° ìê¸ˆ í™œìš© ë° ìì‚° ì¬ë°°ë¶„',
                        caution: 'ëŒ€ì¶œ ìƒí™˜ ëŠ¥ë ¥ ê³ ë ¤í•œ ì‹ ì¤‘í•œ ì˜ì‚¬ê²°ì •'
                    }
                }
            ]
        };

        // Get lifecycle events
        const lifecycleEvents = Storage.getItem('lifecycle_events') || [];

        // Elements
        const eventsTrack = document.getElementById('eventsTrack');
        const stageCards = document.getElementById('stageCards');
        const backdrop = document.getElementById('backdrop');
        const detailSheet = document.getElementById('detailSheet');
        const sheetTitle = document.getElementById('sheetTitle');
        const sheetBody = document.getElementById('sheetBody');
        const closeSheet = document.getElementById('closeSheet');
        const editRoadmapBtn = document.getElementById('editRoadmapBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn');

        let selectedStage = null;

        // Render lifecycle events
        function renderEvents() {
            if (lifecycleEvents.length === 0) {
                eventsTrack.style.display = 'none';
                return;
            }

            eventsTrack.innerHTML = lifecycleEvents.map(event => {
                const icons = {
                    'ê²°í˜¼': 'ğŸ’’',
                    'ì¶œì‚°': 'ğŸ‘¶',
                    'ìë…€êµìœ¡': 'ğŸ“',
                    'ì€í‡´': 'ğŸŒ´',
                    'ê¸°íƒ€': 'ğŸ“Œ'
                };

                return `
                    <div class="event-marker">
                        <span class="event-icon">${icons[event.type] || 'ğŸ“Œ'}</span>
                        <span>${event.name}</span>
                    </div>
                `;
            }).join('');
        }

        // Render stages
        function renderStages() {
            stageCards.innerHTML = sampleRoadmap.stages.map((stage, index) => {
                const [year, month] = stage.date.split('-');

                return `
                    <div class="stage-card" data-stage="${stage.id}" onclick="selectStage(${stage.id})">
                        <div class="stage-icon">${stage.icon}</div>
                        <div class="stage-name">${stage.name}</div>
                        <div class="stage-date">${year}ë…„ ${parseInt(month)}ì›”</div>
                        <div class="stage-price">${Utils.formatCurrency(stage.price)}ì›</div>
                        <div class="stage-type">${stage.type}</div>
                    </div>
                `;
            }).join('');
        }

        // Select stage
        window.selectStage = function(stageId) {
            selectedStage = sampleRoadmap.stages.find(s => s.id === stageId);
            if (!selectedStage) return;

            // Update active state
            document.querySelectorAll('.stage-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-stage="${stageId}"]`).classList.add('active');

            // Render detail
            sheetTitle.textContent = selectedStage.name;
            sheetBody.innerHTML = `
                <div class="detail-section">
                    <h3 class="detail-section-title">ì¶”ì²œ ì£¼íƒ íŠ¹ì§•</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">ìœ„ì¹˜</span>
                            <span class="detail-value">${selectedStage.location}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">íƒ€ì…</span>
                            <span class="detail-value">${selectedStage.houseType}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì˜ˆìƒ ê°€ê²©</span>
                            <span class="detail-value">${Utils.formatCurrency(selectedStage.price)}ì›</span>
                        </div>
                        <div style="margin-top: var(--spacing-sm);">
                            <div class="detail-label" style="margin-bottom: var(--spacing-xs);">ì£¼ìš” ê³ ë ¤ì‚¬í•­</div>
                            <div class="detail-text">${selectedStage.considerations}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">ì¬ë¬´ ëª©í‘œ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">í•„ìš” ìê¸ˆ</span>
                            <span class="detail-value">${Utils.formatCurrency(selectedStage.financialGoal.needed)}ì›</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì €ì¶• ëª©í‘œ</span>
                            <span class="detail-value">${Utils.formatCurrency(selectedStage.financialGoal.savings)}ì›</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì˜ˆìƒ ëŒ€ì¶œ</span>
                            <span class="detail-value">${Utils.formatCurrency(selectedStage.financialGoal.loan)}ì›</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">ì‹¤í–‰ ì „ëµ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">ì›”ë³„ ì €ì¶•ì•¡</span>
                            <span class="detail-value">${Utils.formatCurrency(selectedStage.strategy.monthlySavings)}ì›</span>
                        </div>
                        <div style="margin-top: var(--spacing-sm);">
                            <div class="detail-label" style="margin-bottom: var(--spacing-xs);">íˆ¬ì ë°©í–¥</div>
                            <div class="detail-text">${selectedStage.strategy.investment}</div>
                        </div>
                        <div style="margin-top: var(--spacing-sm);">
                            <div class="detail-label" style="margin-bottom: var(--spacing-xs);">ì£¼ì˜ì‚¬í•­</div>
                            <div class="detail-text">${selectedStage.strategy.caution}</div>
                        </div>
                    </div>
                </div>
            `;

            backdrop.classList.add('active');
            detailSheet.classList.add('active');
        };

        // Close sheet
        function closeSheetFn() {
            backdrop.classList.remove('active');
            detailSheet.classList.remove('active');
        }

        closeSheet.addEventListener('click', closeSheetFn);
        backdrop.addEventListener('click', closeSheetFn);

        // Update guide section
        function updateGuide() {
            const firstStage = sampleRoadmap.stages[0];
            document.getElementById('monthlySavings').textContent =
                Utils.formatCurrency(firstStage.strategy.monthlySavings) + 'ì›';

            // Simulate progress (60% for demo)
            document.getElementById('savingsProgress').style.width = '60%';
            document.getElementById('savingsLabel').textContent = 'ëª©í‘œ ëŒ€ë¹„ 60% ë‹¬ì„±';

            // Calculate time remaining
            const targetDate = new Date(firstStage.date + '-01');
            const now = new Date();
            const diffTime = targetDate - now;
            const diffMonths = Math.ceil(diffTime / (1000 * 60 * 60 * 24 * 30));

            document.getElementById('timeRemaining').textContent = `${diffMonths}ê°œì›” ë‚¨ìŒ`;
            document.getElementById('timeProgress').style.width = '40%';
        }

        // Action buttons
        editRoadmapBtn.addEventListener('click', () => {
            window.location.href = '17-ìƒì• ì£¼ê¸°ì´ë²¤íŠ¸ê´€ë¦¬.html';
        });

        downloadBtn.addEventListener('click', () => {
            UI.showToast('PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ í”„ë¡œí† íƒ€ì…ì—ì„œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'info');
        });

        shareBtn.addEventListener('click', () => {
            UI.showToast('ê³µìœ  ê¸°ëŠ¥ì€ í”„ë¡œí† íƒ€ì…ì—ì„œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'info');
        });

        // Initialize
        renderEvents();
        renderStages();
        updateGuide();

        // Auto-select first stage
        setTimeout(() => {
            selectStage(1);
        }, 500);
    </script>

    <!-- í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ (Mobile) -->
    <nav class="bottom-nav">
        <a href="00-ëŒ€ì‹œë³´ë“œ.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="2"/>
                <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>í™ˆ</span>
        </a>
        <a href="13-ì…ì£¼í¬ë§ì£¼íƒëª©ë¡.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>ì£¼íƒ</span>
        </a>
        <a href="15-ì…ì£¼í›„ì§€ì¶œê³„ì‚°.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>ê³„ì‚°</span>
        </a>
        <a href="18-ì¥ê¸°ì£¼ê±°ë¡œë“œë§µì¡°íšŒ.html" class="nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>ë¡œë“œë§µ</span>
        </a>
    </nav>
</body>
</html>
