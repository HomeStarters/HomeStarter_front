<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì¶œìƒí’ˆ ëª©ë¡</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md);
            padding-bottom: 100px;
        }

        /* Search and Filter */
        .filter-section {
            margin-bottom: var(--spacing-lg);
        }

        .search-box {
            position: relative;
            margin-bottom: var(--spacing-md);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md) var(--spacing-sm) 40px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
        }

        .search-icon {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filter-chips {
            display: flex;
            gap: var(--spacing-xs);
            overflow-x: auto;
            padding-bottom: var(--spacing-xs);
            -webkit-overflow-scrolling: touch;
        }

        .filter-chips::-webkit-scrollbar {
            display: none;
        }

        .chip {
            padding: var(--spacing-xs) var(--spacing-md);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            background: white;
            font-size: var(--font-size-sm);
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Sort Controls */
        .sort-controls {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .sort-btn {
            padding: var(--spacing-xs) var(--spacing-md);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            background: white;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all 0.2s;
        }

        .sort-btn.active {
            background: var(--primary-light);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Loan Cards */
        .loan-grid {
            display: grid;
            gap: var(--spacing-md);
            grid-template-columns: 1fr;
        }

        .loan-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all 0.2s;
        }

        .loan-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .loan-title-group {
            flex: 1;
        }

        .loan-name {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .loan-target {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .bookmark-btn {
            padding: var(--spacing-xs);
            border: none;
            background: none;
            cursor: pointer;
            font-size: 24px;
            transition: transform 0.2s;
        }

        .bookmark-btn:hover {
            transform: scale(1.1);
        }

        .bookmark-btn.active {
            color: var(--warning);
        }

        .loan-highlights {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
        }

        .highlight-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-2xs);
        }

        .highlight-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .highlight-value {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
        }

        .loan-requirements {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .requirement-tag {
            padding: var(--spacing-2xs) var(--spacing-sm);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xxl) var(--spacing-md);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: var(--spacing-md);
        }

        .empty-state h3 {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (min-width: 768px) {
            .loan-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .loan-highlights {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .loan-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <button class="btn-back" onclick="history.back()" aria-label="ë’¤ë¡œ ê°€ê¸°">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <h1 class="header-title">ëŒ€ì¶œìƒí’ˆ</h1>
        <div class="header-actions"></div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Search and Filter -->
            <div class="filter-section">
                <div class="search-box">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 12L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <input type="text" class="search-input" id="searchInput" placeholder="ëŒ€ì¶œìƒí’ˆ ê²€ìƒ‰...">
                </div>

                <div class="filter-chips" id="filterChips">
                    <button class="chip active" data-filter="all">ì „ì²´</button>
                    <button class="chip" data-filter="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</button>
                    <button class="chip" data-filter="ì˜¤í”¼ìŠ¤í…”">ì˜¤í”¼ìŠ¤í…”</button>
                    <button class="chip" data-filter="ë¹Œë¼/ì£¼íƒ">ë¹Œë¼/ì£¼íƒ</button>
                    <button class="chip" data-filter="ë¬´ì£¼íƒì">ë¬´ì£¼íƒì</button>
                    <button class="chip" data-filter="ì‹ í˜¼ë¶€ë¶€">ì‹ í˜¼ë¶€ë¶€</button>
                </div>
            </div>

            <!-- Sort Controls -->
            <div class="sort-controls">
                <button class="sort-btn active" data-sort="recent">ìµœì‹ ìˆœ</button>
                <button class="sort-btn" data-sort="rate">ê¸ˆë¦¬ìˆœ</button>
                <button class="sort-btn" data-sort="limit">í•œë„ìˆœ</button>
            </div>

            <!-- Loan Grid -->
            <div class="loan-grid" id="loanGrid">
                <!-- Cards will be rendered here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon">ğŸ’³</div>
                <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ í•„í„°ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”</p>
            </div>
        </div>
    </main>

    <script src="common.js"></script>
    <script>
        // Sample data
        const sampleLoans = [
            {
                id: 1,
                name: 'ì‹ í˜¼ë¶€ë¶€ íŠ¹ë³„ëŒ€ì¶œ',
                limit: 300000000,
                ltv: 70,
                dti: 60,
                dsr: 40,
                rate: 2.5,
                target: '6ì–µ ì´í•˜ ì•„íŒŒíŠ¸',
                targetType: 'ì•„íŒŒíŠ¸',
                requirements: ['ë¬´ì£¼íƒì', 'ì‹ í˜¼ë¶€ë¶€', 'ë¶€ë¶€í•©ì‚° ì—°ì†Œë“ 7ì²œë§Œì› ì´í•˜'],
                note: 'í˜¼ì¸ì‹ ê³  7ë…„ ì´ë‚´ ì‹ í˜¼ë¶€ë¶€',
                bookmarked: false,
                createdAt: '2025-01-15'
            },
            {
                id: 2,
                name: 'ìƒì• ìµœì´ˆ ì£¼íƒêµ¬ì…ìê¸ˆëŒ€ì¶œ',
                limit: 400000000,
                ltv: 80,
                dti: 60,
                dsr: 40,
                rate: 2.8,
                target: '9ì–µ ì´í•˜ ì•„íŒŒíŠ¸',
                targetType: 'ì•„íŒŒíŠ¸',
                requirements: ['ë¬´ì£¼íƒì', 'ìƒì• ìµœì´ˆ', 'ë¶€ë¶€í•©ì‚° ì—°ì†Œë“ 1ì–µ ì´í•˜'],
                note: 'ìƒì• ìµœì´ˆ ì£¼íƒ êµ¬ì…ì ëŒ€ìƒ',
                bookmarked: false,
                createdAt: '2025-01-10'
            },
            {
                id: 3,
                name: 'ì²­ë…„ ì˜¤í”¼ìŠ¤í…” êµ¬ì…ìê¸ˆëŒ€ì¶œ',
                limit: 200000000,
                ltv: 60,
                dti: 50,
                dsr: 40,
                rate: 3.2,
                target: '3ì–µ ì´í•˜ ì˜¤í”¼ìŠ¤í…”',
                targetType: 'ì˜¤í”¼ìŠ¤í…”',
                requirements: ['ë§Œ 34ì„¸ ì´í•˜', 'ë¬´ì£¼íƒì', 'ì—°ì†Œë“ 4ì²œë§Œì› ì´í•˜'],
                note: 'ì²­ë…„ì¸µ ì£¼ê±° ì•ˆì • ì§€ì›',
                bookmarked: false,
                createdAt: '2025-01-05'
            },
            {
                id: 4,
                name: 'ì¼ë°˜ì£¼íƒë‹´ë³´ëŒ€ì¶œ',
                limit: 500000000,
                ltv: 70,
                dti: 60,
                dsr: 40,
                rate: 4.5,
                target: 'ì „ì²´ ì£¼íƒ',
                targetType: 'ë¹Œë¼/ì£¼íƒ',
                requirements: ['ì†Œë“ì¦ë¹™ ê°€ëŠ¥ì'],
                note: 'ì¼ë°˜ ì£¼íƒ ë‹´ë³´ ëŒ€ì¶œ',
                bookmarked: false,
                createdAt: '2025-01-01'
            },
            {
                id: 5,
                name: 'ë‹¤ìë…€ ê°€êµ¬ íŠ¹ë³„ëŒ€ì¶œ',
                limit: 350000000,
                ltv: 80,
                dti: 70,
                dsr: 50,
                rate: 2.3,
                target: '9ì–µ ì´í•˜ ì•„íŒŒíŠ¸',
                targetType: 'ì•„íŒŒíŠ¸',
                requirements: ['2ìë…€ ì´ìƒ', 'ë¬´ì£¼íƒ ë˜ëŠ” 1ì£¼íƒ', 'ë¶€ë¶€í•©ì‚° ì—°ì†Œë“ 1ì–µ ì´í•˜'],
                note: 'ë‹¤ìë…€ ê°€êµ¬ ìš°ëŒ€',
                bookmarked: false,
                createdAt: '2024-12-28'
            },
            {
                id: 6,
                name: 'ë²„íŒ€ëª© ì „ì„¸ìê¸ˆëŒ€ì¶œ',
                limit: 100000000,
                ltv: 70,
                dti: 50,
                dsr: 40,
                rate: 1.8,
                target: 'ì „ì„¸ë³´ì¦ê¸ˆ',
                targetType: 'ì•„íŒŒíŠ¸',
                requirements: ['ë¬´ì£¼íƒì', 'ë¶€ë¶€í•©ì‚° ì—°ì†Œë“ 5ì²œë§Œì› ì´í•˜'],
                note: 'ì „ì„¸ ìê¸ˆ ì§€ì›',
                bookmarked: false,
                createdAt: '2024-12-25'
            }
        ];

        // State
        let loans = [...sampleLoans];
        let filteredLoans = [...loans];
        let currentFilter = 'all';
        let currentSort = 'recent';
        let searchQuery = '';
        let bookmarkedIds = new Set();

        // Elements
        const searchInput = document.getElementById('searchInput');
        const filterChips = document.getElementById('filterChips').querySelectorAll('.chip');
        const sortBtns = document.querySelectorAll('.sort-btn');
        const loanGrid = document.getElementById('loanGrid');
        const emptyState = document.getElementById('emptyState');

        // Load bookmarks
        function loadBookmarks() {
            const saved = Storage.getItem('loan_bookmarks') || [];
            bookmarkedIds = new Set(saved);
        }

        // Save bookmarks
        function saveBookmarks() {
            Storage.setItem('loan_bookmarks', Array.from(bookmarkedIds));
        }

        // Search
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            filterAndSort();
        });

        // Filter
        filterChips.forEach(chip => {
            chip.addEventListener('click', () => {
                filterChips.forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                currentFilter = chip.dataset.filter;
                filterAndSort();
            });
        });

        // Sort
        sortBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                sortBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSort = btn.dataset.sort;
                filterAndSort();
            });
        });

        // Filter and sort
        function filterAndSort() {
            // Filter
            filteredLoans = loans.filter(loan => {
                // Search filter
                if (searchQuery) {
                    const matchName = loan.name.toLowerCase().includes(searchQuery);
                    const matchTarget = loan.target.toLowerCase().includes(searchQuery);
                    const matchRequirements = loan.requirements.some(req =>
                        req.toLowerCase().includes(searchQuery)
                    );
                    if (!matchName && !matchTarget && !matchRequirements) {
                        return false;
                    }
                }

                // Type filter
                if (currentFilter !== 'all') {
                    const matchType = loan.targetType === currentFilter;
                    const matchRequirement = loan.requirements.includes(currentFilter);
                    if (!matchType && !matchRequirement) {
                        return false;
                    }
                }

                return true;
            });

            // Sort
            if (currentSort === 'recent') {
                filteredLoans.sort((a, b) => b.createdAt.localeCompare(a.createdAt));
            } else if (currentSort === 'rate') {
                filteredLoans.sort((a, b) => a.rate - b.rate);
            } else if (currentSort === 'limit') {
                filteredLoans.sort((a, b) => b.limit - a.limit);
            }

            renderLoans();
        }

        // Render loans
        function renderLoans() {
            if (filteredLoans.length === 0) {
                loanGrid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            loanGrid.style.display = 'grid';
            emptyState.style.display = 'none';

            loanGrid.innerHTML = filteredLoans.map(loan => `
                <div class="loan-card" onclick="viewDetail(${loan.id})">
                    <div class="loan-header">
                        <div class="loan-title-group">
                            <h3 class="loan-name">${loan.name}</h3>
                            <div class="loan-target">${loan.target}</div>
                        </div>
                        <button class="bookmark-btn ${bookmarkedIds.has(loan.id) ? 'active' : ''}"
                                onclick="event.stopPropagation(); toggleBookmark(${loan.id})"
                                aria-label="ë¶ë§ˆí¬">
                            ${bookmarkedIds.has(loan.id) ? 'â˜…' : 'â˜†'}
                        </button>
                    </div>

                    <div class="loan-highlights">
                        <div class="highlight-item">
                            <div class="highlight-label">ëŒ€ì¶œí•œë„</div>
                            <div class="highlight-value">${Format.currency(loan.limit)}</div>
                        </div>
                        <div class="highlight-item">
                            <div class="highlight-label">ê¸ˆë¦¬</div>
                            <div class="highlight-value">ì—° ${loan.rate}%</div>
                        </div>
                        <div class="highlight-item">
                            <div class="highlight-label">LTV</div>
                            <div class="highlight-value">ìµœëŒ€ ${loan.ltv}%</div>
                        </div>
                        <div class="highlight-item">
                            <div class="highlight-label">DTI</div>
                            <div class="highlight-value">ìµœëŒ€ ${loan.dti}%</div>
                        </div>
                    </div>

                    <div class="loan-requirements">
                        ${loan.requirements.map(req => `
                            <span class="requirement-tag">${req}</span>
                        `).join('')}
                    </div>

                    <button class="btn btn-secondary loan-detail-btn" onclick="event.stopPropagation(); viewDetail(${loan.id})" style="width: 100%; margin-top: var(--spacing-md);">
                        ìƒì„¸ë³´ê¸°
                    </button>
                </div>
            `).join('');
        }

        // Toggle bookmark
        window.toggleBookmark = function(id) {
            if (bookmarkedIds.has(id)) {
                bookmarkedIds.delete(id);
                UI.showToast('ë¶ë§ˆí¬ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
            } else {
                bookmarkedIds.add(id);
                UI.showToast('ë¶ë§ˆí¬ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            }
            saveBookmarks();
            renderLoans();
        };

        // View detail
        window.viewDetail = function(id) {
            Storage.setItem('selected_loan_id', id);
            window.location.href = '09-ëŒ€ì¶œìƒí’ˆìƒì„¸.html';
        };

        // Initialize
        loadBookmarks();
        Storage.setItem('loan_products', sampleLoans);
        filterAndSort();
    </script>
</body>
</html>
