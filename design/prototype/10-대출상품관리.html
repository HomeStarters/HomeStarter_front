<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì¶œìƒí’ˆ ê´€ë¦¬</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md);
            padding-bottom: 100px;
        }

        /* Admin Actions */
        .admin-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            gap: var(--spacing-sm);
        }

        .admin-actions h2 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin: 0;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .stat-value {
            font-size: var(--font-size-xxl);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
        }

        /* Products Table */
        .products-table-container {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
        }

        .products-table thead {
            background: var(--bg-primary);
        }

        .products-table th {
            padding: var(--spacing-md);
            text-align: left;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
        }

        .products-table td {
            padding: var(--spacing-md);
            font-size: var(--font-size-md);
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
        }

        .products-table tbody tr:hover {
            background: var(--bg-primary);
        }

        .products-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
        }

        .status-badge.active {
            background: var(--success-light);
            color: var(--success);
        }

        .status-badge.inactive {
            background: var(--text-disabled);
            color: var(--text-secondary);
        }

        /* Action Buttons */
        .table-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .btn-icon-small {
            padding: var(--spacing-xs);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition-fast);
            border-radius: var(--radius-sm);
        }

        .btn-icon-small:hover {
            background: var(--bg-primary);
            color: var(--primary);
        }

        .btn-icon-small.danger:hover {
            color: var(--danger);
        }

        /* Mobile Card View */
        .products-cards {
            display: none;
        }

        .product-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-sm);
        }

        .product-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .product-card-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .product-card-info {
            display: grid;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .product-card-row {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
        }

        .product-card-label {
            color: var(--text-secondary);
        }

        .product-card-value {
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xxl);
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--spacing-md);
        }

        /* Form Styles */
        .form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .input,
        .textarea {
            width: 100%;
            padding: 12px var(--spacing-md);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            font-family: inherit;
            transition: all var(--transition-normal);
        }

        .input:focus,
        .textarea:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }

        /* Responsive */
        @media (max-width: 767px) {
            .products-table-container {
                display: none;
            }

            .products-cards {
                display: block;
            }

            .admin-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <button class="btn-back" onclick="history.back()" aria-label="ë’¤ë¡œ ê°€ê¸°">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <h1 class="header-title">ëŒ€ì¶œìƒí’ˆ ê´€ë¦¬</h1>
        <div style="width: 24px;"></div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Admin Actions -->
            <div class="admin-actions">
                <h2>ëŒ€ì¶œìƒí’ˆ ëª©ë¡</h2>
                <button class="btn btn-primary" onclick="openAddForm()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                        <path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    ìƒí’ˆ ì¶”ê°€
                </button>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ ìƒí’ˆ</div>
                    <div class="stat-value" id="totalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í™œì„± ìƒí’ˆ</div>
                    <div class="stat-value" id="activeCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë¹„í™œì„± ìƒí’ˆ</div>
                    <div class="stat-value" id="inactiveCount">0</div>
                </div>
            </div>

            <!-- Table View (Desktop) -->
            <div class="products-table-container">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ìƒíƒœ</th>
                            <th>ëŒ€ì¶œì´ë¦„</th>
                            <th>ëŒ€ì¶œí•œë„</th>
                            <th>ê¸ˆë¦¬</th>
                            <th>LTV</th>
                            <th>DTI</th>
                            <th>ëŒ€ìƒì£¼íƒ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Will be rendered dynamically -->
                    </tbody>
                </table>
            </div>

            <!-- Card View (Mobile) -->
            <div class="products-cards" id="productsCards">
                <!-- Will be rendered dynamically -->
            </div>
        </div>
    </main>

    <!-- Modal for Add/Edit Form -->
    <div id="formModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <h3 id="formTitle">ëŒ€ì¶œìƒí’ˆ ì¶”ê°€</h3>
                <button class="icon-button" onclick="closeFormModal()" aria-label="ë‹«ê¸°">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="productForm" class="form">
                    <div class="form-group">
                        <label class="label" for="productName">ëŒ€ì¶œì´ë¦„ *</label>
                        <input type="text" id="productName" class="input" required>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productLimit">ëŒ€ì¶œí•œë„ (ë§Œì›) *</label>
                        <input type="number" id="productLimit" class="input" min="0" step="1000" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="label" for="productLTV">LTV í•œë„ (%) *</label>
                            <input type="number" id="productLTV" class="input" min="0" max="100" step="5" required>
                        </div>

                        <div class="form-group">
                            <label class="label" for="productDTI">DTI í•œë„ (%) *</label>
                            <input type="number" id="productDTI" class="input" min="0" max="100" step="5" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productDSR">DSR í•œë„ (%) *</label>
                        <input type="number" id="productDSR" class="input" min="0" max="100" step="5" required>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productRate">ê¸ˆë¦¬ (%) *</label>
                        <input type="number" id="productRate" class="input" min="0" max="20" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productTarget">ëŒ€ìƒì£¼íƒ *</label>
                        <input type="text" id="productTarget" class="input" placeholder="ì˜ˆ: 6ì–µ ì´í•˜ ì£¼íƒ" required>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productTargetType">ëŒ€ìƒìœ í˜• *</label>
                        <select id="productTargetType" class="input" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì‹ í˜¼ë¶€ë¶€">ì‹ í˜¼ë¶€ë¶€</option>
                            <option value="ìƒì• ìµœì´ˆ">ìƒì• ìµœì´ˆ</option>
                            <option value="ì²­ë…„">ì²­ë…„</option>
                            <option value="ì¼ë°˜">ì¼ë°˜</option>
                            <option value="ë‹¤ìë…€">ë‹¤ìë…€</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productRequirements">ìê²©ìš”ê±´ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„) *</label>
                        <textarea id="productRequirements" class="textarea" rows="4" placeholder="ì˜ˆ:&#10;ë¬´ì£¼íƒ ì„¸ëŒ€ì£¼&#10;ì—°ì†Œë“ 7ì²œë§Œì› ì´í•˜&#10;ë¶€ë¶€í•©ì‚° ìì‚° 3.45ì–µì› ì´í•˜" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="label" for="productNote">ë¹„ê³ </label>
                        <textarea id="productNote" class="textarea" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="productActive" checked>
                            <span>í™œì„±í™”</span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary btn-full" onclick="closeFormModal()">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-primary btn-full">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // State
        let products = [];
        let editingId = null;

        // Elements
        const productsTableBody = document.getElementById('productsTableBody');
        const productsCards = document.getElementById('productsCards');
        const formModal = document.getElementById('formModal');
        const productForm = document.getElementById('productForm');
        const formTitle = document.getElementById('formTitle');

        // Load data
        function loadData() {
            const stored = localStorage.getItem('loan_products');
            products = stored ? JSON.parse(stored) : [];
            renderProducts();
            updateStats();
        }

        // Render products
        function renderProducts() {
            // Table view
            if (products.length === 0) {
                productsTableBody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“‹</div>
                                <div>ë“±ë¡ëœ ëŒ€ì¶œìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                productsTableBody.innerHTML = products.map(product => `
                    <tr>
                        <td>
                            <span class="status-badge ${product.active ? 'active' : 'inactive'}">
                                ${product.active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </span>
                        </td>
                        <td>${product.name}</td>
                        <td>${Format.currency(product.limit)}</td>
                        <td>ì—° ${product.rate}%</td>
                        <td>ìµœëŒ€ ${product.ltv}%</td>
                        <td>ìµœëŒ€ ${product.dti}%</td>
                        <td>${product.target}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn-icon-small" onclick="toggleActive('${product.id}')" title="${product.active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}">
                                    ${product.active ? 'â¸ï¸' : 'â–¶ï¸'}
                                </button>
                                <button class="btn-icon-small" onclick="editProduct('${product.id}')" title="ìˆ˜ì •">
                                    âœï¸
                                </button>
                                <button class="btn-icon-small danger" onclick="deleteProduct('${product.id}')" title="ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            // Card view
            if (products.length === 0) {
                productsCards.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div>ë“±ë¡ëœ ëŒ€ì¶œìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                    </div>
                `;
            } else {
                productsCards.innerHTML = products.map(product => `
                    <div class="product-card">
                        <div class="product-card-header">
                            <div>
                                <div class="product-card-title">${product.name}</div>
                                <span class="status-badge ${product.active ? 'active' : 'inactive'}">
                                    ${product.active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                </span>
                            </div>
                        </div>
                        <div class="product-card-info">
                            <div class="product-card-row">
                                <span class="product-card-label">ëŒ€ì¶œí•œë„</span>
                                <span class="product-card-value">${Format.currency(product.limit)}</span>
                            </div>
                            <div class="product-card-row">
                                <span class="product-card-label">ê¸ˆë¦¬</span>
                                <span class="product-card-value">ì—° ${product.rate}%</span>
                            </div>
                            <div class="product-card-row">
                                <span class="product-card-label">LTV / DTI</span>
                                <span class="product-card-value">ìµœëŒ€ ${product.ltv}% / ìµœëŒ€ ${product.dti}%</span>
                            </div>
                            <div class="product-card-row">
                                <span class="product-card-label">ëŒ€ìƒì£¼íƒ</span>
                                <span class="product-card-value">${product.target}</span>
                            </div>
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-secondary flex-1" onclick="toggleActive('${product.id}')">
                                ${product.active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
                            </button>
                            <button class="btn btn-secondary flex-1" onclick="editProduct('${product.id}')">
                                ìˆ˜ì •
                            </button>
                            <button class="btn btn-danger flex-1" onclick="deleteProduct('${product.id}')">
                                ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalCount').textContent = products.length;
            document.getElementById('activeCount').textContent = products.filter(p => p.active).length;
            document.getElementById('inactiveCount').textContent = products.filter(p => !p.active).length;
        }

        // Open add form
        window.openAddForm = function() {
            editingId = null;
            formTitle.textContent = 'ëŒ€ì¶œìƒí’ˆ ì¶”ê°€';
            productForm.reset();
            document.getElementById('productActive').checked = true;
            formModal.classList.remove('hidden');
        };

        // Edit product
        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            editingId = id;
            formTitle.textContent = 'ëŒ€ì¶œìƒí’ˆ ìˆ˜ì •';

            document.getElementById('productName').value = product.name;
            document.getElementById('productLimit').value = product.limit;
            document.getElementById('productLTV').value = product.ltv;
            document.getElementById('productDTI').value = product.dti;
            document.getElementById('productDSR').value = product.dsr;
            document.getElementById('productRate').value = product.rate;
            document.getElementById('productTarget').value = product.target;
            document.getElementById('productTargetType').value = product.targetType;
            document.getElementById('productRequirements').value = product.requirements.join('\n');
            document.getElementById('productNote').value = product.note || '';
            document.getElementById('productActive').checked = product.active;

            formModal.classList.remove('hidden');
        };

        // Delete product
        window.deleteProduct = function(id) {
            if (!confirm('ì´ ëŒ€ì¶œìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            products = products.filter(p => p.id !== id);
            localStorage.setItem('loan_products', JSON.stringify(products));
            UI.showToast('ëŒ€ì¶œìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            renderProducts();
            updateStats();
        };

        // Toggle active status
        window.toggleActive = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            product.active = !product.active;
            localStorage.setItem('loan_products', JSON.stringify(products));
            UI.showToast(`ëŒ€ì¶œìƒí’ˆì´ ${product.active ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}ë˜ì—ˆìŠµë‹ˆë‹¤`, 'info');
            renderProducts();
            updateStats();
        };

        // Close form modal
        window.closeFormModal = function() {
            formModal.classList.add('hidden');
        };

        // Form submit
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('productName').value.trim(),
                limit: parseInt(document.getElementById('productLimit').value),
                ltv: parseInt(document.getElementById('productLTV').value),
                dti: parseInt(document.getElementById('productDTI').value),
                dsr: parseInt(document.getElementById('productDSR').value),
                rate: parseFloat(document.getElementById('productRate').value),
                target: document.getElementById('productTarget').value.trim(),
                targetType: document.getElementById('productTargetType').value,
                requirements: document.getElementById('productRequirements').value.trim().split('\n').filter(r => r.trim()),
                note: document.getElementById('productNote').value.trim(),
                active: document.getElementById('productActive').checked
            };

            if (editingId) {
                // Update existing
                const index = products.findIndex(p => p.id === editingId);
                if (index !== -1) {
                    products[index] = {
                        ...products[index],
                        ...formData,
                        updatedAt: new Date().toISOString()
                    };
                }
                UI.showToast('ëŒ€ì¶œìƒí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else {
                // Add new
                const newProduct = {
                    id: 'loan_' + Date.now(),
                    ...formData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                products.push(newProduct);
                UI.showToast('ëŒ€ì¶œìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            }

            localStorage.setItem('loan_products', JSON.stringify(products));
            renderProducts();
            updateStats();
            closeFormModal();
        });

        // Modal background click to close
        formModal.addEventListener('click', (e) => {
            if (e.target === formModal) {
                closeFormModal();
            }
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
